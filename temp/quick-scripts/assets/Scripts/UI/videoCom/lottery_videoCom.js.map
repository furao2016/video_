{"version":3,"sources":["lottery_videoCom.js"],"names":["cc","_decorator","ccclass","property","lottery_videoCom","String","Sprite","Boolean","Node","loadOver","texureImag","_socketController","outPutWidth","outPutHeight","game","on","EVENT_HIDE","gameHideClose","EVENT_SHOW","gameShowReOpen","url","isPlay","_renderType","RENDER_TYPE_CANVAS","console","log","currentUrl","ebet","baccarat","VideoSocketController","VideoShader","videoShader1","ShaderEffect","node","Texture2D","targetSprite","getComponent","spriteFrame","SpriteFrame","height","width","onPictureDecoded","bind","actionNode","callFunc","rotation","repfor","repeatForever","sequence","delayTime","runAction","target","data","pixelFormat","pixelsWidth","pixelsHeight","contentSize","_currentBuffer","initWithData","close","_currentUrl","reOpen","dt","onRenderingBefore","Myrendering","videoSize","off","unscheduleAllCallbacks","Component"],"mappings":"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","file":"lottery_videoCom.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Scripts\\UI\\videoCom","sourcesContent":["import videoShader1 from \"./videoShader1\";\r\nconst { ccclass, property } = cc._decorator;\r\n@ccclass\r\nexport default class lottery_videoCom extends cc.Component {\r\n    //目标链接\r\n    @property(cc.String)\r\n    currentUrl = 'ws://ws4.jiasula.info:8081/lobbyB/B15/19148936/6eca0113e34c41c1f45a5f9eaf13429c'\r\n    @property(cc.Sprite)\r\n    targetSprite = null;\r\n    @property(cc.Boolean)\r\n    isPlay = false; //是否播放,这里不能完全控制\r\n    @property(cc.Node)\r\n    actionNode = null;\r\n\r\n    loadOver = false;\r\n\r\n    //\r\n    texureImag = null;\r\n    //socket控制\r\n    _socketController = null;\r\n    //输出大小\r\n    outPutWidth = 0;\r\n    outPutHeight = 0;\r\n\r\n    onLoad() {\r\n        cc.game.on(cc.game.EVENT_HIDE, this.gameHideClose, this);\r\n        cc.game.on(cc.game.EVENT_SHOW, this.gameShowReOpen, this);\r\n    }\r\n\r\n    init(url, isPlay = false) {\r\n        if (cc._renderType == cc.game.RENDER_TYPE_CANVAS) {\r\n            console.log('canvas下无法播放');\r\n            return;\r\n        }\r\n        this.isPlay = isPlay;\r\n        this.currentUrl = url || this.currentUrl;\r\n        this._socketController = new ebet.baccarat.VideoSocketController(this.currentUrl, false, true);\r\n        this.VideoShader = new videoShader1();\r\n        this.VideoShader.ShaderEffect(this.node);\r\n        this.texureImag = new cc.Texture2D();\r\n        !this.targetSprite && (this.targetSprite = this.node.getComponent(cc.Sprite));\r\n        this.targetSprite.spriteFrame = new cc.SpriteFrame(this.texureImag);\r\n        this.outPutHeight = this.node.height;\r\n        this.outPutWidth = this.node.width;\r\n        this._socketController.onPictureDecoded = this.onPictureDecoded.bind(this);\r\n        if (this.actionNode) {\r\n            let callFunc = cc.callFunc(function () {\r\n                this.actionNode.rotation += 30;\r\n                this.actionNode.rotation %= 360;\r\n            }.bind(this));\r\n            let repfor = cc.repeatForever(cc.sequence(cc.delayTime(0.1), callFunc));\r\n            this.actionNode.runAction(repfor)\r\n        }\r\n    }\r\n    //暂停\r\n    pause() {\r\n        this.isPlay = false;\r\n        this.gameHideClose();\r\n    }\r\n    //开始\r\n    continue() {\r\n        this.isPlay = true;\r\n        this.gameShowReOpen();\r\n    }\r\n    //播放投射到其他地方\r\n    changeTargetSprite(target) {\r\n        target.spriteFrame = new cc.SpriteFrame(this.texureImag);\r\n        this.VideoShader.ShaderEffect(target.node);\r\n        target.node.height = 1080;\r\n        target.node.width = 1980\r\n    }\r\n\r\n    //图片编码\r\n    onPictureDecoded(data, pixelFormat, pixelsWidth, pixelsHeight, contentSize) {\r\n        if (!this.isPlay) return;\r\n        this.loadOver = true;\r\n        this.VideoShader._currentBuffer = data;\r\n        this.texureImag.initWithData(data, pixelFormat, pixelsWidth, pixelsHeight, contentSize);\r\n    }\r\n\r\n    gameHideClose() {\r\n        if (this._socketController) {\r\n            this._socketController.close();\r\n        }\r\n    }\r\n\r\n    gameShowReOpen() {\r\n        if (this._socketController && this.isPlay) {\r\n            this._socketController._currentUrl = this.currentUrl;\r\n            this._socketController.reOpen();\r\n        }\r\n    }\r\n\r\n    update(dt) {\r\n        if (!this.isPlay) return;\r\n        if (this._socketController && this._socketController.onRenderingBefore) {\r\n            this._socketController.onRenderingBefore(dt);\r\n            this.VideoShader.Myrendering(ebet.videoSize);\r\n        }\r\n    }\r\n\r\n    onDestroy() {\r\n        cc.game.off(cc.game.EVENT_HIDE, this.gameHideClose);\r\n        cc.game.off(cc.game.EVENT_SHOW, this.gameShowReOpen);\r\n        this._socketController.close();\r\n        this._socketController = null;\r\n        this.unscheduleAllCallbacks();\r\n    }\r\n}\r\n"]}