{"version":3,"sources":["lottery_MsgStation.js"],"names":["simulationAward","lottery_MsgStation","httpServer","socketIP","socketPort","loging","socket","SocketManager","getInstance","On","MsgDefine","DOWN","SC_OK","socketConnect","SC_VideoMsg","videoMsg","SC_KaiPan","lotteryOpeningOrClosed","SC_JianQi","setJianQi","SC_JIANQIU","lotteryResults","SC_VideoUrl","lotteryVideoUrlChange","GlobalMsg","Register","lottery_EventDefine","sys","loadingOvertime","account","password","Helper","showLoading","NetManager","HttpPost","error","msg","showTips","code","lottery_lotteryData","updataData","data","console","log","lottery_loginViewCtr","OnMessageHandle","type","roleList","lotteryCode","Connect","userId","one","Send","JSON","stringify","lottery_VideoSysCtr","lottery_VideoPlayCtr","Close","Open","screenfull","request","document","getElementById","close","getVideoUrl","videosMsgFatory","ins","changePeriod","cc","systemEvent","emit","VIDEOFLOW","RESTART","expect","nestExpect","countDownTime","BALLINFO","videoUrl","parse","codeBack","noticeInit","sysEventInit","SingletonBase","setTimeout"],"mappings":"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","file":"lottery_MsgStation.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Scripts\\Data","sourcesContent":["import SingletonBase from \"../Singleton/SingletonBase\";\r\nimport NetManager from \"../Manager/lottery_NetManager\";\r\nimport SocketManager from \"../Manager/lottery_SocketManager\";\r\nimport MsgDefine from \"../Manager/lottery_SockMsgDefine\";\r\nimport GlobalMsg from \"../Core/Event/lottery_GlobalMsg\";\r\nimport { lottery_EventDefine } from \"./lottery_EventDefine\";\r\nimport Helper from \"../UI/tools/lottery_helper\";\r\nimport lottery_VideoSysCtr from \"../UI/view_videoSys/lottery_VideoSysCtr\";\r\nimport lottery_loginViewCtr from \"../UI/view_login/lottery_loginViewCtr\";\r\nimport lottery_VideoPlayCtr from \"../UI/view_videoPlay/lottery_VideoPlayCtr\";\r\nimport videosMsgFatory from \"../UI/view_videoSys/videoMsgFactory\";\r\nimport lottery_lotteryData from \"./lottery_lotteryData\";\r\n/**\r\n * 消息中转\r\n */\r\nexport default class lottery_MsgStation extends SingletonBase {\r\n    httpServer = \"\";\r\n    socketIP = \"\";\r\n    socketPort = \"\";\r\n    loging = false; //登陆中\r\n\r\n    static _onNewObject() {\r\n        let one = new lottery_MsgStation();\r\n        one.noticeInit();\r\n        one.sysEventInit();\r\n        return one;\r\n    }\r\n    /**\r\n     * ws消息初始化\r\n     */\r\n    noticeInit() {\r\n        let socket = SocketManager.getInstance();\r\n        socket.On(MsgDefine.DOWN.SC_OK, this.socketConnect, this);\r\n        socket.On(MsgDefine.DOWN.SC_VideoMsg, this.videoMsg, this);\r\n        socket.On(MsgDefine.DOWN.SC_KaiPan, this.lotteryOpeningOrClosed, this);\r\n        socket.On(MsgDefine.DOWN.SC_JianQi, this.setJianQi, this);\r\n        socket.On(MsgDefine.DOWN.SC_JIANQIU, this.lotteryResults, this);\r\n        socket.On(MsgDefine.DOWN.SC_VideoUrl, this.lotteryVideoUrlChange, this);\r\n    }\r\n    /**\r\n     * 系统消息初始化\r\n     */\r\n    sysEventInit() {\r\n        GlobalMsg.getInstance().Register(lottery_EventDefine.sys.loadingOvertime, this.loadingOvertime);\r\n    }\r\n\r\n    /*----------------------------------------------本地事件------------------------------------------------*/\r\n    /**\r\n    * 登录\r\n    */\r\n    onSendEnterLogin(account, password) {\r\n        Helper.getInstance().showLoading();\r\n        NetManager.getInstance().HttpPost(this.httpServer + 'dealer/login/video/check', { \"userName\": account, \"password\": password }, (error, msg) => {\r\n            Helper.getInstance().showLoading(false);\r\n            if (error) {\r\n                Helper.getInstance().showTips('网络错误');\r\n                return;\r\n            }\r\n            switch (msg.code) {\r\n                case 1:\r\n                    lottery_lotteryData.getInstance().updataData(msg.data);\r\n                    console.log(msg.data);\r\n                    lottery_loginViewCtr.getInstance().OnMessageHandle({ type: 1, data: lottery_lotteryData.getInstance().roleList });\r\n                    break;\r\n                case 0:\r\n                    Helper.getInstance().showTips('检查下服务器');\r\n                    break;\r\n                default:\r\n                    Helper.getInstance().showTips('密码或者账号错误');\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     *根据彩种登陆\r\n     */\r\n    onSendLotteryChoice(lotteryCode) {\r\n        Helper.getInstance().showLoading();\r\n        lottery_lotteryData.getInstance().lotteryCode = lotteryCode;\r\n        SocketManager.getInstance().Connect(this.socketIP, this.socketPort, lottery_lotteryData.getInstance().userId);//与服务器建立长连接\r\n    }\r\n\r\n    /**\r\n     * 链接荷官端\r\n     */\r\n    onSendLinkHeGuan() {\r\n        Helper.getInstance().showLoading();\r\n        let one = {\r\n            'codeBack': 2020,\r\n            'data': {\r\n                'lotteryCode': lottery_lotteryData.getInstance().lotteryCode\r\n            }\r\n        };\r\n        SocketManager.getInstance().Send(JSON.stringify(one));\r\n        lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 1 });\r\n    }\r\n\r\n    /**\r\n     * 荷官端链接成功准备播放视频\r\n     */\r\n    onSendLinkHeGuanSuccess() {\r\n        Helper.getInstance().showLoading(false);\r\n        lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 2 });\r\n    }\r\n    /**\r\n     * 切换到全屏播放\r\n     */\r\n    onFullPlay() {\r\n        lottery_VideoPlayCtr.getInstance().Close();\r\n        lottery_VideoSysCtr.getInstance().Open();\r\n        //切换到全屏\r\n        screenfull.request(document.getElementById('Cocos2dGameContainer'));\r\n    }\r\n    /**\r\n     * 回到系统\r\n     */\r\n    onBackToSys() {\r\n        Helper.getInstance().showLoading(false);\r\n        lottery_VideoPlayCtr.getInstance().Open();\r\n        lottery_VideoSysCtr.getInstance().Close();\r\n    }\r\n    /**\r\n    * 退出\r\n    */\r\n    onSendLogoutContent() {\r\n        SocketManager.getInstance().close();\r\n        lottery_VideoPlayCtr.getInstance().Close();\r\n        lottery_loginViewCtr.getInstance().Open();\r\n\r\n    }\r\n    /*------------------------------------------socket回调--------------------------------------*/\r\n    //建立长连接成功\r\n    socketConnect(data) {\r\n        console.log('建立长链接');\r\n        this.getVideoUrl();\r\n        lottery_loginViewCtr.getInstance().Close();\r\n        lottery_VideoPlayCtr.getInstance().Open();\r\n        Helper.getInstance().showLoading(false);\r\n    }\r\n\r\n    //链接何荷官端后得回调\r\n    videoMsg(data) {\r\n        if (data == 1)\r\n            lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 2 })\r\n        else if (data == 0)\r\n            lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 3 });\r\n    }\r\n    //接收到开封盘命令\r\n    lotteryOpeningOrClosed(data) {\r\n        console.log(data);\r\n        if (data == 0) {\r\n            videosMsgFatory.ins().changePeriod(-1);\r\n        } else {\r\n            videosMsgFatory.ins().changePeriod(2);\r\n        }\r\n        cc.systemEvent.emit(lottery_EventDefine.VIDEOFLOW.RESTART);\r\n    }\r\n    //收到奖期之后 马上跳播\r\n    setJianQi(data) {\r\n        lottery_lotteryData.getInstance().expect = data.expect;\r\n        lottery_lotteryData.getInstance().nestExpect = data.nestExpect;\r\n        videosMsgFatory.ins().changePeriod(0);\r\n        cc.systemEvent.emit(lottery_EventDefine.VIDEOFLOW.RESTART);\r\n        videosMsgFatory.ins().changePeriod(-1);\r\n    }\r\n\r\n    //接收到当前期售彩结束准备开奖,?第一期 马上跳播\r\n    lotteryOpenAward() {\r\n        videosMsgFatory.ins().changePeriod(0);\r\n        cc.systemEvent.emit(lottery_EventDefine.VIDEOFLOW.RESTART);\r\n    }\r\n\r\n    //接收到当前期播放倒计时\r\n    lotteryReadyAward(data) {\r\n        videosMsgFatory.ins().countDownTime = data;\r\n    }\r\n    //接收到开奖结果\r\n    lotteryResults(data) {\r\n        console.log(data);\r\n        cc.systemEvent.emit(lottery_EventDefine.VIDEOFLOW.BALLINFO, data);\r\n    }\r\n    /**接收到视频链接更改*/\r\n    lotteryVideoUrlChange(data) {\r\n        lottery_lotteryData.getInstance().videoUrl = JSON.parse(data.videoUrl);\r\n        console.log(lottery_lotteryData.getInstance().videoUrl);\r\n    }\r\n    /**请求视频链接*/\r\n    getVideoUrl() {\r\n        let msg = {};\r\n        msg.codeBack = MsgDefine.DOWN.SC_VideoUrl;\r\n        msg.data = { type: \"GET\", lotteryCode: lottery_lotteryData.getInstance().lotteryCode };\r\n        SocketManager.getInstance().Send(JSON.stringify(msg));\r\n    }\r\n    /*-----------------------------------------系统事件回调-----------------------------------------*/\r\n    loadingOvertime() {\r\n        console.log(\"加载超时\");\r\n    }\r\n}\r\n\r\nexport function simulationAward() {\r\n    let one = 0;\r\n    setTimeout(() => {\r\n        lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 4 });\r\n        setTimeout(() => {\r\n            lottery_MsgStation.getInstance().lotteryOpeningOrClosed(0);\r\n            setTimeout(() => {\r\n                lottery_MsgStation.getInstance().setJianQi({ expect: 11, nestExpect: 12 })\r\n            }, 10000);\r\n        }, 10000);\r\n    }, 5000);\r\n}"]}