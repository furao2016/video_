{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Scripts\\Data/assets\\Scripts\\Data\\lottery_MsgStation.js"],"names":["simulationAward","lottery_MsgStation","httpServer","socketIP","socketPort","loging","socket","SocketManager","getInstance","On","MsgDefine","DOWN","SC_OK","socketConnect","SC_VideoMsg","videoMsg","SC_KaiPan","lotteryOpeningOrClosed","SC_JianQi","setJianQi","SC_JIANQIU","lotteryResults","GlobalMsg","Register","lottery_EventDefine","sys","loadingOvertime","account","password","Helper","showLoading","NetManager","HttpPost","error","msg","showTips","code","lottery_lotteryData","updataData","data","lottery_loginViewCtr","OnMessageHandle","type","roleList","lotteryCode","Close","lottery_VideoPlayCtr","Open","Connect","userId","lottery_VideoSysCtr","screenfull","request","document","getElementById","close","one","Send","JSON","stringify","videosMsgFatory","ins","changePeriod","expect","next","nestExpect","console","log","cc","systemEvent","emit","VIDEOFLOW","RESTART","countDownTime","BALLINFO","noticeInit","sysEventInit","SingletonBase","setTimeout","lotteryOpenAward","lotteryReadyAward"],"mappings":"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","file":"lottery_MsgStation.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Scripts\\Data","sourcesContent":["import SingletonBase from \"../Singleton/SingletonBase\";\r\nimport NetManager from \"../Manager/lottery_NetManager\";\r\nimport SocketManager from \"../Manager/lottery_SocketManager\";\r\nimport lottery_lotteryData from \"./lottery_lotteryData\";\r\nimport MsgDefine from \"../Manager/lottery_SockMsgDefine\";\r\nimport GlobalMsg from \"../Core/Event/lottery_GlobalMsg\";\r\nimport { lottery_EventDefine } from \"./lottery_EventDefine\";\r\nimport Helper from \"../UI/tools/lottery_helper\";\r\nimport lottery_VideoSysCtr from \"../UI/view_videoSys/lottery_VideoSysCtr\";\r\nimport lottery_loginViewCtr from \"../UI/view_login/lottery_loginViewCtr\";\r\nimport lottery_VideoPlayCtr from \"../UI/view_videoPlay/lottery_VideoPlayCtr\";\r\nimport videosMsgFatory from \"../UI/view_videoSys/videoMsgFactory\";\r\n/**\r\n * 消息中转\r\n */\r\nexport default class lottery_MsgStation extends SingletonBase {\r\n    httpServer = \"\";\r\n    socketIP = \"\";\r\n    socketPort = \"\";\r\n    loging = false; //登陆中\r\n\r\n    static _onNewObject() {\r\n        let one = new lottery_MsgStation();\r\n        one.noticeInit();\r\n        one.sysEventInit();\r\n        return one;\r\n    }\r\n    /**\r\n     * ws消息初始化\r\n     */\r\n    noticeInit() {\r\n        let socket = SocketManager.getInstance();\r\n        socket.On(MsgDefine.DOWN.SC_OK, this.socketConnect, this);\r\n        socket.On(MsgDefine.DOWN.SC_VideoMsg, this.videoMsg, this);\r\n        socket.On(MsgDefine.DOWN.SC_KaiPan, this.lotteryOpeningOrClosed, this);\r\n        socket.On(MsgDefine.DOWN.SC_JianQi, this.setJianQi, this);\r\n        socket.On(MsgDefine.DOWN.SC_JIANQIU,this.lotteryResults,this);\r\n    }\r\n    /**\r\n     * 系统消息初始化\r\n     */\r\n    sysEventInit() {\r\n        GlobalMsg.getInstance().Register(lottery_EventDefine.sys.loadingOvertime, this.loadingOvertime);\r\n    }\r\n\r\n    /*----------------------------------------------本地事件------------------------------------------------*/\r\n    /**\r\n    * 登录\r\n    */\r\n    onSendEnterLogin(account, password) {\r\n        Helper.getInstance().showLoading();\r\n        NetManager.getInstance().HttpPost(this.httpServer + 'dealer/login/video/check', { \"userName\": account, \"password\": password }, (error, msg) => {\r\n            Helper.getInstance().showLoading(false);\r\n            if (error) {\r\n                Helper.getInstance().showTips('网络错误');\r\n                return;\r\n            }\r\n            switch (msg.code) {\r\n                case 1:\r\n                    lottery_lotteryData.getInstance().updataData(msg.data);\r\n                    lottery_loginViewCtr.getInstance().OnMessageHandle({ type: 1, data: lottery_lotteryData.getInstance().roleList });\r\n                    break;\r\n                case 0:\r\n                    Helper.getInstance().showTips('检查下服务器');\r\n                    break;\r\n                default:\r\n                    Helper.getInstance().showTips('密码或者账号错误');\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     *根据彩种登陆\r\n     */\r\n    onSendLotteryChoice(lotteryCode) {\r\n        lottery_lotteryData.getInstance().lotteryCode = lotteryCode;\r\n        lottery_loginViewCtr.getInstance().Close();\r\n        lottery_VideoPlayCtr.getInstance().Open();\r\n    }\r\n\r\n    /**\r\n     * 链接荷官端\r\n     */\r\n    onSendLinkHeGuan() {\r\n        Helper.getInstance().showLoading();\r\n        SocketManager.getInstance().Connect(this.socketIP, this.socketPort, lottery_lotteryData.getInstance().userId);//与服务器建立长连接\r\n        lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 1 });\r\n    }\r\n\r\n    /**\r\n     * 荷官端链接成功准备播放视频\r\n     */\r\n    onSendLinkHeGuanSuccess() {\r\n        Helper.getInstance().showLoading(false);\r\n        lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 2 });\r\n    }\r\n    /**\r\n     * 切换到全屏播放\r\n     */\r\n    onFullPlay() {\r\n        lottery_VideoPlayCtr.getInstance().Close();\r\n        lottery_VideoSysCtr.getInstance().Open();\r\n        //切换到全屏\r\n        screenfull.request(document.getElementById('Cocos2dGameContainer'));\r\n    }\r\n    /**\r\n     * 回到系统\r\n     */\r\n    onBackToSys() {\r\n        Helper.getInstance().showLoading(false);\r\n        lottery_VideoPlayCtr.getInstance().Open();\r\n        lottery_VideoSysCtr.getInstance().Close();\r\n    }\r\n    /**\r\n    * 退出\r\n    */\r\n    onSendLogoutContent() {\r\n        SocketManager.getInstance().close();\r\n        lottery_VideoPlayCtr.getInstance().Close();\r\n        lottery_loginViewCtr.getInstance().Open();\r\n\r\n    }\r\n    /*------------------------------------------socket回调--------------------------------------*/\r\n    //建立长连接成功\r\n    socketConnect(data) {\r\n        Helper.getInstance().showLoading(false);\r\n        let one = {\r\n            'codeBack': 2020,\r\n            'data': {\r\n                'lotteryCode': lottery_lotteryData.getInstance().lotteryCode\r\n            }\r\n        };\r\n        SocketManager.getInstance().Send(JSON.stringify(one));\r\n    }\r\n\r\n    //链接何荷官端后得回调\r\n    videoMsg(data) {\r\n        if (data == 1)\r\n            lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 2 })\r\n        else if (data == 0)\r\n            lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 3 });\r\n    }\r\n    //接收到开封盘命令\r\n    lotteryOpeningOrClosed(data) {\r\n        if (data == 0) {\r\n            videosMsgFatory.ins().changePeriod(-1);\r\n        } else {\r\n            videosMsgFatory.ins().changePeriod(1);\r\n        }\r\n    }\r\n    //设置奖期\r\n    setJianQi(data) {\r\n        let expect = data.expect; //当前期号\r\n        let next = data.nestExpect;\r\n        console.log(data);\r\n    }\r\n\r\n    //接收到当前期售彩结束准备开奖,?第一期 马上跳播\r\n    lotteryOpenAward() {\r\n        videosMsgFatory.ins().changePeriod(0);\r\n        cc.systemEvent.emit(lottery_EventDefine.VIDEOFLOW.RESTART);\r\n    }\r\n    //接收到当前期播放倒计时\r\n    lotteryReadyAward(data) {\r\n        videosMsgFatory.ins().countDownTime = data;\r\n    }\r\n    //接收到开奖结果\r\n    lotteryResults(data) {\r\n        console.log(data);\r\n        cc.systemEvent.emit(lottery_EventDefine.VIDEOFLOW.BALLINFO, data);\r\n    }\r\n    /*-----------------------------------------系统事件回调-----------------------------------------*/\r\n    loadingOvertime() {\r\n        console.log(\"加载超时\");\r\n    }\r\n}\r\n\r\nexport function simulationAward() {\r\n    let one = 0;\r\n    setTimeout(() => {\r\n        lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 4 });\r\n        setTimeout(() => {\r\n            lottery_MsgStation.getInstance().lotteryOpenAward();\r\n            lottery_MsgStation.getInstance().lotteryReadyAward(7);\r\n        }, 0);\r\n    }, 5000);\r\n}"]}