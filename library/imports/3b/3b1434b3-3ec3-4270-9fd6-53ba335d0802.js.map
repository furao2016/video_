{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Scripts\\Data/assets\\Scripts\\Data\\lottery_MsgStation.js"],"names":["simulationAward","lottery_MsgStation","lotteryData","lottery_lotteryData","getInstance","socket","SocketManager","On","MsgDefine","DOWN","SC_OK","socketConnect","SC_VideoMsg","videoMsg","SC_KaiPan","lotteryOpeningOrClosed","SC_JianQi","setJianQi","SC_JIANQIU","lotteryResults","SC_VideoUrl","lotteryVideoUrlChange","GlobalMsg","Register","lottery_EventDefine","sys","loadingOvertime","account","password","Helper","showLoading","NetManager","HttpPost","network","httpServer","error","msg","showTips","code","updataData","data","console","log","lottery_loginViewCtr","OnMessageHandle","type","roleList","lotteryCode","Connect","socketIP","socketPort","userId","one","Send","JSON","stringify","lottery_VideoSysCtr","lottery_VideoPlayCtr","Close","Open","screenfull","request","document","getElementById","close","videosMsgFatory","ins","changePeriod","cc","systemEvent","emit","VIDEOFLOW","RESTART","expect","nestExpect","countDownTime","BALLINFO","videoUrl","parse","codeBack","noticeInit","sysEventInit","SingletonBase","setTimeout"],"mappings":"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","file":"lottery_MsgStation.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Scripts\\Data","sourcesContent":["import SingletonBase from \"../Singleton/SingletonBase\";\r\nimport NetManager from \"../Manager/lottery_NetManager\";\r\nimport SocketManager from \"../Manager/lottery_SocketManager\";\r\nimport MsgDefine from \"../Manager/lottery_SockMsgDefine\";\r\nimport GlobalMsg from \"../Core/Event/lottery_GlobalMsg\";\r\nimport { lottery_EventDefine } from \"./lottery_EventDefine\";\r\nimport Helper from \"../UI/tools/lottery_helper\";\r\nimport lottery_VideoSysCtr from \"../UI/view_videoSys/lottery_VideoSysCtr\";\r\nimport lottery_loginViewCtr from \"../UI/view_login/lottery_loginViewCtr\";\r\nimport lottery_VideoPlayCtr from \"../UI/view_videoPlay/lottery_VideoPlayCtr\";\r\nimport videosMsgFatory from \"../UI/view_videoSys/videoMsgFactory\";\r\nimport lottery_lotteryData from \"./lottery_lotteryData\";\r\n/**\r\n * 消息中转\r\n */\r\nexport default class lottery_MsgStation extends SingletonBase {\r\n    lotteryData = lottery_lotteryData.getInstance();\r\n\r\n    static _onNewObject() {\r\n        let one = new lottery_MsgStation();\r\n        one.noticeInit();\r\n        one.sysEventInit();\r\n        return one;\r\n    }\r\n    /**\r\n     * ws消息初始化\r\n     */\r\n    noticeInit() {\r\n        let socket = SocketManager.getInstance();\r\n        socket.On(MsgDefine.DOWN.SC_OK, this.socketConnect, this);\r\n        socket.On(MsgDefine.DOWN.SC_VideoMsg, this.videoMsg, this);\r\n        socket.On(MsgDefine.DOWN.SC_KaiPan, this.lotteryOpeningOrClosed, this);\r\n        socket.On(MsgDefine.DOWN.SC_JianQi, this.setJianQi, this);\r\n        socket.On(MsgDefine.DOWN.SC_JIANQIU, this.lotteryResults, this);\r\n        socket.On(MsgDefine.DOWN.SC_VideoUrl, this.lotteryVideoUrlChange, this);\r\n    }\r\n    /**\r\n     * 系统消息初始化\r\n     */\r\n    sysEventInit() {\r\n        GlobalMsg.getInstance().Register(lottery_EventDefine.sys.loadingOvertime, this.loadingOvertime);\r\n    }\r\n\r\n    /*----------------------------------------------本地事件------------------------------------------------*/\r\n    /**\r\n    * 登录\r\n    */\r\n    onSendEnterLogin(account, password) {\r\n        Helper.getInstance().showLoading();\r\n        NetManager.getInstance().HttpPost(this.lotteryData.network.httpServer + 'dealer/login/video/check', { \"userName\": account, \"password\": password }, (error, msg) => {\r\n            Helper.getInstance().showLoading(false);\r\n            if (error) {\r\n                Helper.getInstance().showTips('网络错误');\r\n                return;\r\n            }\r\n            switch (msg.code) {\r\n                case 1:\r\n                    lottery_lotteryData.getInstance().updataData(msg.data);\r\n                    console.log(msg.data);\r\n                    lottery_loginViewCtr.getInstance().OnMessageHandle({ type: 1, data: lottery_lotteryData.getInstance().roleList });\r\n                    break;\r\n                case 0:\r\n                    Helper.getInstance().showTips('检查下服务器');\r\n                    break;\r\n                default:\r\n                    Helper.getInstance().showTips('密码或者账号错误');\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     *根据彩种登陆\r\n     */\r\n    onSendLotteryChoice(lotteryCode) {\r\n        Helper.getInstance().showLoading();\r\n        this.lotteryData.lotteryCode = lotteryCode;\r\n        SocketManager.getInstance().Connect(this.lotteryData.network.socketIP, this.lotteryData.network.socketPort, this.lotteryData.userId);//与服务器建立长连接\r\n    }\r\n\r\n    /**\r\n     * 链接荷官端\r\n     */\r\n    onSendLinkHeGuan() {\r\n        Helper.getInstance().showLoading();\r\n        let one = {\r\n            'codeBack': 2020,\r\n            'data': {\r\n                'lotteryCode': lottery_lotteryData.getInstance().lotteryCode\r\n            }\r\n        };\r\n        SocketManager.getInstance().Send(JSON.stringify(one));\r\n        lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 1 });\r\n    }\r\n\r\n    /**\r\n     * 荷官端链接成功准备播放视频\r\n     */\r\n    onSendLinkHeGuanSuccess() {\r\n        Helper.getInstance().showLoading(false);\r\n        lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 2 });\r\n    }\r\n    /**\r\n     * 切换到全屏播放\r\n     */\r\n    onFullPlay() {\r\n        lottery_VideoPlayCtr.getInstance().Close();\r\n        lottery_VideoSysCtr.getInstance().Open();\r\n        //切换到全屏\r\n        screenfull.request(document.getElementById('Cocos2dGameContainer'));\r\n    }\r\n    /**\r\n     * 回到系统\r\n     */\r\n    onBackToSys() {\r\n        Helper.getInstance().showLoading(false);\r\n        lottery_VideoPlayCtr.getInstance().Open();\r\n        lottery_VideoSysCtr.getInstance().Close();\r\n    }\r\n    /**\r\n    * 退出\r\n    */\r\n    onSendLogoutContent() {\r\n        SocketManager.getInstance().close();\r\n        lottery_VideoPlayCtr.getInstance().Close();\r\n        lottery_loginViewCtr.getInstance().Open();\r\n\r\n    }\r\n    /*------------------------------------------socket回调--------------------------------------*/\r\n    //建立长连接成功\r\n    socketConnect(data) {\r\n        console.log('建立长链接');\r\n        lottery_loginViewCtr.getInstance().Close();\r\n        lottery_VideoPlayCtr.getInstance().Open();\r\n        Helper.getInstance().showLoading(false);\r\n    }\r\n\r\n    //链接何荷官端后得回调\r\n    videoMsg(data) {\r\n        if (data == 1)\r\n            lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 2 })\r\n        else if (data == 0)\r\n            lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 3 });\r\n    }\r\n    //接收到开封盘命令\r\n    lotteryOpeningOrClosed(data) {\r\n        console.log(data);\r\n        if (data == 0) {\r\n            videosMsgFatory.ins().changePeriod(-1);\r\n        } else {\r\n            videosMsgFatory.ins().changePeriod(2);\r\n        }\r\n        cc.systemEvent.emit(lottery_EventDefine.VIDEOFLOW.RESTART);\r\n    }\r\n    //收到奖期之后 马上跳播\r\n    setJianQi(data) {\r\n        lottery_lotteryData.getInstance().expect = data.expect;\r\n        lottery_lotteryData.getInstance().nestExpect = data.nestExpect;\r\n        videosMsgFatory.ins().changePeriod(0);\r\n        cc.systemEvent.emit(lottery_EventDefine.VIDEOFLOW.RESTART);\r\n        videosMsgFatory.ins().changePeriod(-1);\r\n    }\r\n\r\n    //接收到当前期售彩结束准备开奖,?第一期 马上跳播\r\n    lotteryOpenAward() {\r\n        videosMsgFatory.ins().changePeriod(0);\r\n        cc.systemEvent.emit(lottery_EventDefine.VIDEOFLOW.RESTART);\r\n    }\r\n\r\n    //接收到当前期播放倒计时\r\n    lotteryReadyAward(data) {\r\n        videosMsgFatory.ins().countDownTime = data;\r\n    }\r\n    //接收到开奖结果\r\n    lotteryResults(data) {\r\n        console.log(data);\r\n        cc.systemEvent.emit(lottery_EventDefine.VIDEOFLOW.BALLINFO, data);\r\n    }\r\n    /**接收到视频链接更改*/\r\n    lotteryVideoUrlChange(data) {\r\n        lottery_lotteryData.getInstance().videoUrl = JSON.parse(data.videoUrl);\r\n        console.log(lottery_lotteryData.getInstance().videoUrl);\r\n    }\r\n    /**请求视频链接*/\r\n    getVideoUrl() {\r\n        let msg = {};\r\n        msg.codeBack = MsgDefine.DOWN.SC_VideoUrl;\r\n        msg.data = { type: \"GET\", lotteryCode: lottery_lotteryData.getInstance().lotteryCode };\r\n        SocketManager.getInstance().Send(JSON.stringify(msg));\r\n    }\r\n    /*-----------------------------------------系统事件回调-----------------------------------------*/\r\n    loadingOvertime() {\r\n        console.log(\"加载超时\");\r\n    }\r\n}\r\n\r\nexport function simulationAward() {\r\n    let one = 0;\r\n    setTimeout(() => {\r\n        lottery_VideoSysCtr.getInstance().OnMessageHandle({ type: 4 });\r\n        setTimeout(() => {\r\n            lottery_MsgStation.getInstance().lotteryOpeningOrClosed(0);\r\n            setTimeout(() => {\r\n                lottery_MsgStation.getInstance().setJianQi({ expect: 1000000001, nestExpect: 1000000002 })\r\n            }, 10000);\r\n        }, 10000);\r\n    }, 1000);\r\n}"]}