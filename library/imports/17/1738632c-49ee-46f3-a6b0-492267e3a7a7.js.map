{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Scripts\\UI\\videoCom/assets\\Scripts\\UI\\videoCom\\lottery_videoCom.js"],"names":["cc","_decorator","ccclass","property","lottery_videoCom","String","Sprite","texureImag","targetSpriteFrame","_socketController","isPlay","game","on","EVENT_HIDE","gameHideClose","EVENT_SHOW","gameShowReOpen","init","_renderType","RENDER_TYPE_CANVAS","console","log","targetSprite","node","getComponent","addComponent","VideoShader","videoShader1","ShaderEffect","Texture2D","SpriteFrame","spriteFrame","url","currentUrl","active","_packageCache","clear","setUrl","lottery","video","VideoSocketController","onPictureDecoded","bind","target","height","width","data","pixelFormat","pixelsWidth","pixelsHeight","contentSize","_currentBuffer","initWithData","parent","close","_currentUrl","reOpen","dt","onRenderingBefore","Myrendering","ebet","videoSize","off","Component"],"mappings":"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","file":"lottery_videoCom.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Scripts\\UI\\videoCom","sourcesContent":["import videoShader1 from \"./videoShader1\";\r\nconst { ccclass, property } = cc._decorator;\r\n@ccclass\r\nexport default class lottery_videoCom extends cc.Component {\r\n    //目标链接\r\n    @property(cc.String)\r\n    currentUrl = 'ws://ws4.jiasula.info:8081/lobbyB/B15/19148936/6eca0113e34c41c1f45a5f9eaf13429c'\r\n    @property(cc.Sprite)\r\n    targetSprite = null; //目标sprite\r\n\r\n    /*目标纹理2D*/\r\n    texureImag = null;\r\n    /**目标spriteFrame*/\r\n    targetSpriteFrame = null;\r\n    /**socket控制*/\r\n    _socketController = null;\r\n\r\n    /**isplay*/\r\n    isPlay = false;\r\n\r\n    onLoad() {\r\n        cc.game.on(cc.game.EVENT_HIDE, this.gameHideClose, this);\r\n        cc.game.on(cc.game.EVENT_SHOW, this.gameShowReOpen, this);\r\n        this.init();\r\n    }\r\n\r\n    onEnable() {\r\n        this.gameShowReOpen();\r\n    }\r\n\r\n    onDisable() {\r\n        this.gameHideClose();\r\n    }\r\n\r\n    init() {\r\n        if (cc._renderType == cc.game.RENDER_TYPE_CANVAS) {\r\n            console.log('canvas下无法播放');\r\n            return;\r\n        }\r\n        this.isPlay = true;\r\n        //获取播放sprite\r\n        !this.targetSprite && (this.targetSprite = this.node.getComponent(cc.Sprite));\r\n        !this.targetSprite && (this.targetSprite = this.node.addComponent(cc.Sprite));\r\n        //创建纹理\r\n        this.VideoShader = new videoShader1();\r\n        this.VideoShader.ShaderEffect(this.targetSprite.node);\r\n        this.texureImag = new cc.Texture2D();\r\n        //绑定sprite\r\n        this.targetSpriteFrame = new cc.SpriteFrame(this.texureImag);\r\n        this.targetSprite.spriteFrame = this.targetSpriteFrame;\r\n    }\r\n\r\n    //设置url\r\n    setUrl(url) {\r\n        this.targetSprite.spriteFrame = null;\r\n        this.currentUrl = url;\r\n        if (this._socketController) {\r\n            if (this.node.active) {\r\n                this._socketController._packageCache.clear();\r\n                this._socketController.setUrl(this.currentUrl);\r\n            }\r\n        } else {\r\n            this._socketController = new lottery.video.VideoSocketController(this.currentUrl, false, true);\r\n            this._socketController.onPictureDecoded = this.onPictureDecoded.bind(this);\r\n        }\r\n    }\r\n    //播放投射到其他地方\r\n    changeTargetSprite(target) {\r\n        target.spriteFrame = new cc.SpriteFrame(this.texureImag);\r\n        this.VideoShader.ShaderEffect(target.node);\r\n        target.node.height = 1080;\r\n        target.node.width = 1980\r\n    }\r\n\r\n    //图片编码\r\n    onPictureDecoded(data, pixelFormat, pixelsWidth, pixelsHeight, contentSize) {\r\n        if (!this.isPlay) return;\r\n        if (!this.targetSprite.spriteFrame) this.targetSprite.spriteFrame = this.targetSpriteFrame;\r\n        this.VideoShader._currentBuffer = data;\r\n        this.texureImag.initWithData(data, pixelFormat, pixelsWidth, pixelsHeight, contentSize);\r\n        this.targetSprite.node.width = this.node.parent.width;\r\n        this.targetSprite.node.height = this.node.parent.width * pixelsHeight / pixelsWidth;\r\n    }\r\n\r\n    gameHideClose() {\r\n        if (this._socketController) {\r\n            this._socketController.close();\r\n        }\r\n    }\r\n\r\n    gameShowReOpen() {\r\n        if (this._socketController) {\r\n            this._socketController._currentUrl = this.currentUrl;\r\n            this._socketController.reOpen();\r\n        }\r\n    }\r\n\r\n    update(dt) {\r\n        if (this.isPlay && this._socketController && this._socketController.onRenderingBefore) {\r\n            this._socketController.onRenderingBefore(dt);\r\n            this.VideoShader.Myrendering(ebet.videoSize);\r\n        }\r\n    }\r\n\r\n    onDestroy() {\r\n        cc.game.off(cc.game.EVENT_HIDE, this.gameHideClose);\r\n        cc.game.off(cc.game.EVENT_SHOW, this.gameShowReOpen);\r\n        this._socketController.close();\r\n        this._socketController = null;\r\n    }\r\n}\r\n"]}